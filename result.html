<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Check Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center flex-col">

  <div class="bg-white w-full max-w-xl p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold text-center text-blue-900 mb-6">Result Check</h2>

    <!-- Class -->
    <select id="studentClass" class="w-full p-3 mb-4 border rounded">
      <option value="">Select Class</option>
      <option value="1">Class 1</option>
      <option value="2">Class 2</option>
      <option value="3">Class 3</option>
      <option value="4">Class 4</option>
      <option value="5">Class 5</option>
      <option value="6">Class 6</option>
      <option value="7">Class 7</option>
      <option value="8">Class 8</option>
      <option value="9">Class 9</option>
      <option value="11">Class 11</option>
      <option value="12">Class 12</option>
    </select>

    <!-- Symbol -->
    <input id="symbol" type="text" placeholder="Symbol Number *" class="w-full p-3 mb-4 border rounded" />

    <!-- Name (Optional) -->
    <input id="name" type="text" placeholder="Student Name (optional)" class="w-full p-3 mb-4 border rounded" />

    <!-- Button -->
    <button onclick="checkResult()" class="w-full bg-blue-800 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
      Check Result
    </button>

    <!-- Output -->
    <div id="resultOutput" class="hidden mt-6"></div>
  </div>

  <!-- GPA Calculator -->
  <div class="bg-white w-full max-w-xl p-6 rounded-xl shadow-lg mt-8">
    <h2 class="text-xl font-bold text-blue-900 mb-4">GPA Calculator (not accurate but close)</h2>
    <div id="gpaSubjects" class="mb-4">
      <p class="text-gray-700 mb-2">Enter marks for subjects:</p>
      <div id="subjectsInput"></div>
      <button onclick="addSubjectInput()" class="mb-4 bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">Add Subject</button>
    </div>
    <button onclick="calculateGPAFromInputs()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-500">Calculate GPA</button>
    <div id="gpaResult" class="mt-4 font-semibold text-blue-700"></div>
  </div>

  <!-- Back to Home Button -->
  <div class="text-center my-6">
      <a href="index.html" 
         class="inline-block bg-blue-900 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-800 transition">
          ‚Üê Back to Home
      </a>
  </div>

<script>
let resultsData = {};

fetch("results.json")
  .then(res => res.json())
  .then(data => resultsData = data)
  .catch(() => resultsData = {});

function checkResult() {
  const cls = document.getElementById("studentClass").value;
  const symbol = document.getElementById("symbol").value.trim();
  const nameInput = document.getElementById("name").value.trim().toLowerCase();
  const output = document.getElementById("resultOutput");

  output.classList.remove("hidden");
  output.innerHTML = `<p class="text-blue-700 font-semibold">Checking result...</p>`;

  if (!cls || !symbol) {
    output.innerHTML = `<p class="text-red-600 font-semibold">Class and Symbol Number are required.</p>`;
    return;
  }

  if (!resultsData[cls] || resultsData[cls].length === 0) {
    output.innerHTML = `<p class="text-red-600 font-semibold">No results published for Class ${cls} yet.</p>`;
    return;
  }

  const student = resultsData[cls].find(s => s.symbol === symbol);

  if (!student) {
    output.innerHTML = `<p class="text-red-600 font-semibold">Result not found.</p>`;
    return;
  }

  if (nameInput && student.name.toLowerCase() !== nameInput) {
    output.innerHTML = `<p class="text-red-600 font-semibold">Name does not match with symbol number.</p>`;
    return;
  }

  let rows = "";
  for (let subject in student.subjects) {
    const marks = student.subjects[subject];
    rows += `
      <tr>
        <td class="border px-3 py-2">${subject}</td>
        <td class="border px-3 py-2">${marks}</td>
      </tr>`;
  }

  output.innerHTML = `
    <h3 class="text-xl font-bold text-blue-900 mb-2">Result Sheet</h3>
    <p><strong>Name:</strong> ${student.name}</p>
    <p><strong>Symbol:</strong> ${student.symbol}</p>
    <p><strong>Class:</strong> ${cls}</p>

    <table class="w-full mt-4 border">
      <tr class="bg-gray-200">
        <th class="border px-3 py-2">Subject</th>
        <th class="border px-3 py-2">Marks</th>
      </tr>
      ${rows}
    </table>

    <p class="mt-4 font-bold text-green-700">GPA (Official): ${student.gpa ?? "Pending"}</p>
    <button onclick="window.print()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded">Print Marksheet</button>
  `;
}

// GPA Calculator functions
let subjectCount = 0;
function addSubjectInput() {
  subjectCount++;
  const container = document.getElementById('subjectsInput');
  const div = document.createElement('div');
  div.classList.add('mb-2', 'flex', 'gap-2');
  div.innerHTML = `
    <input type='text' placeholder='Subject Name' class='p-2 border rounded w-2/3' id='subjectName${subjectCount}' />
    <input type='number' placeholder='Marks' class='p-2 border rounded w-1/3' id='subjectMarks${subjectCount}' />
  `;
  container.appendChild(div);
}

function calculateGPAFromInputs() {
  let total = 0;
  let count = 0;
  for (let i = 1; i <= subjectCount; i++) {
    const marks = parseFloat(document.getElementById(`subjectMarks${i}`)?.value);
    if (!isNaN(marks)) {
      total += marks;
      count++;
    }
  }
  if (count === 0) {
    document.getElementById('gpaResult').innerText = 'Enter at least one subject marks.';
    return;
  }
  const avg = total / count;
  document.getElementById('gpaResult').innerText = 'Predicted GPA: ' + calculateGPA(avg);
}

function calculateGPA(avg) {
  if (avg >= 90) return "4.00";
  if (avg >= 80) return "3.60";
  if (avg >= 70) return "3.20";
  if (avg >= 60) return "2.80";
  if (avg >= 50) return "2.40";
  if (avg >= 40) return "2.00";
  return "Fail";
}
</script>

</body>
</html>